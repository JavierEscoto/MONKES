Stellarators are an attractive alternative to tokamaks as future fusion reactors. While tokamaks require a large toroidal current to generate part of the magnetic field, in stellarators the field is produced entirely by external magnets. As a consequence, stellarators avoid current-induced instabilities and facilitate steady-state operation. These advantages come at the expense of making the magnetic field three-dimensional. In tokamaks, axisymmetry guarantees that the radial displacement that charged particles experience along their collisionless orbits averages to zero. Therefore, in the absence of collisions, all charged particles are confined. However, in a generic stellarator the orbit-averaged radial drift velocity does not vanish for trapped particles and they quickly drift out of the device. The combination of a non zero orbit-averaged radial drift and a small collision frequency (reactor-relevant fusion plasmas are weakly collisional in the core) produces, for a generic stellarator, intolerably large levels of neoclassical transport. 

Hence, stellarator magnetic fields must be carefully designed in order to display good confinement properties. This process of tailoring of the magnetic field is called stellarator optimization. The objective of neoclassical optimization is to obtain a stellarator with levels of neoclassical losses equivalent or lower to those in an axisymmetric device. Stellarator magnetic fields in which the orbit-averaged radial magnetic drift is zero for all particles are called omnigenous \cite{Cary1997OmnigenityAQ}. Thus, the goal of neoclassical optimization is to obtain magnetic fields which are close to omnigeneity. However, addressing only radial transport in the optimization process is not sufficient. In toroidal plasmas, the parallel flow of electrons and the rest of species is not, in general, balanced. This mismatch produces a net parallel current at each flux surface which, through Amp√®re's law, modifies the magnetic field $\vb*{B}$. When the current is generated by a combination of neoclassical mechanisms and non-zero plasma profile gradients, we speak of bootstrap current. The bootstrap current and its effect on the magnetic configuration must be taken into account in the design of optimized stellarator magnetic fields. 

Two different subclasses of omnigenous stellarators have drawn particular attention: quasi-isodynamic (QI) and quasi-symmetric (QS) stellarators. Quasi-isodynamic configurations are omnigeneous configurations in which the curves of constant magnetic field strength $B:=|\vb*{B}|$ on a flux surface close poloidally. This additional property has an important implication: exactly QI stellarators produce zero bootstrap current at low collisionality \cite{Helander_2009,Helander_2011_Bootstrap}. Thanks to this feature, QI stellarators can control plasma-wall interaction by means of a divertor relying on a specific structure of islands, which could not be realized in the presence of large toroidal currents. The Wendelstein 7-X (W7-X) experiment was designed to be close to QI and demonstrates that theoretically based stellarator optimization can be applied to construct a device with much better confinement properties than any previous stellarator \cite{Beidler2021}. Moreover, the bootstrap current produced in W7-X plasmas is smaller than in non-optimized machines \cite{Dinklage2018}. However, despite its success, there is still room for improvement. The two main configurations of W7-X, the KJM (or so-called ``high mirror'') and the EIM (also known as ``standard'') are not optimized for simultaneously having low levels of radial and parallel neoclassical transport \cite{Beidler_2011, Beidler2021}: While W7-X EIM has small radial transport, it has intolerably large bootstrap current. Conversely, W7-X KJM displays small bootstrap current but larger levels of radial transport. Consequently, optimization of QI stellarators is a very active branch of research and, recently, much effort has been put in pushing forward the design and construction of quasi-isodynamic stellarators \cite{Sanchez_2023,velasco2023robust,RJorge_2022,camachomata_plunk_jorge_2022,goodman2022constructing}.

The QS subclass of omnigenous configurations is attractive as the neoclassical properties of such magnetic fields are isomorphic to those in a tokamak \cite{Pytte_Isomorphic,Boozer_Isomorphic}. Recently, it has been shown that it is possible to design QS magnetic fields with extremely low neoclassical losses \cite{Landreman_PreciseQS}. In contrast to QI configurations, QS stellarators are expected to have a substantial bootstrap current\footnote{With the exception of the quasi-poloidally symmetric magnetic field, which lies at the intersection of QI and QS configurations. However, quasi-poloidal symmetry is impossible to achieve near the magnetic axis, see e.g. \cite{Helander_2014}.} and its effect must be taken into account \cite{Landreman_SelfConsistent}. Examples of this subclass are the Helically Symmetric eXperiment (HSX) \cite{HSX} or the design of the National Compact Stellarator Experiment (NCSX) \cite{NCSX}. 

Typically, at each iteration of the optimization process a large number ($\sim$$10^2$) of magnetic configurations are generated. Therefore, in order to neoclassically optimize magnetic fields, it is required to be able to evaluate fast the neoclassical properties of each configuration. Due to this requirement, neoclassical properties are typically addressed indirectly. For instance, one can tailor the variation of the magnetic field strength $B$ on the flux-surface so that it nearly fulfils quasi-isodinamicity: the isolines of $B$ can be forced to close poloidally and the variance of the extrema of $B$ along field lines can be minimized.
%
%\bluechange{One example derives from the fact that in an omnigenous stellarator local maxima and minima of $B$ along field lines are aligned \cite{Cary1997OmnigenityAQ}. Forcing as much as possible to align these extrema is an example of indirect neoclassical optimization. Similarly, optimizing pursuing that the isolines of $B$ close poloidally on a flux surface, is an example of indirect QI optimization.}

A different approach relies on figures of merit, which are easy to calculate, for specific collisional regimes. For the $1/\nu$ regime, the code {\texttt{NEO}} \cite{Nemov1999EvaluationO1} computes the effective ripple $\epsilon_{\text{eff}}$, which encapsulates the dependence of radial neoclassical transport on the magnetic configuration. For transport within the flux surface, there exist long mean free path formulae for parallel flow and bootstrap current \cite{Shaing-Callen-1983,Nakajima-1988,helander_parra_newton_2017}. Although they can be computed very fast and capture some qualitative behaviour, these formulae are plagued with noise due to resonances in rational surfaces and, even with smoothing ad-hoc techniques, they are not accurate \cite{Landreman_SelfConsistent}. This lack of accuracy limits their application for optimization purposes. During the optimization process, an accurate calculation of the bootstrap current is required to account for its effect (e.g. for optimizing QS stellarators) or to keep it sufficiently small (when optimizing for quasi-isodinamicity). 

Recent developments allow direct optimization of radial neoclassical transport. Based on previous derivations \cite{Calvo_2017,dherbemont2022}, the code {\texttt{KNOSOS}} \cite{KNOSOSJCP,KNOSOSJPP} solves very fast an orbit-averaged drift-kinetic equation that is accurate for low collisionality regimes. {\texttt{KNOSOS}} is included in the stellarator optimization suite \texttt{STELLOPT} \cite{STELLOPT} and in the predictive transport frameworks {\texttt{TANGO}} \cite{Banon_Navarro_2023} and \texttt{TRINITY} \cite{Barnes_Trinity_2010}. However, the orbit-averaged equations solved by {\texttt{KNOSOS}} only describe radial transport at low collisionalities. 

In this work we present {\MONKES} (MONoenergetic Kinetic Equation Solver), a new neoclassical code conceived to satisfy the necessity of fast and accurate calculations of the bootstrap current for stellarator optimization. Specifically, {\MONKES} makes it possible to compute the monoenergetic coefficients $\widehat{D}_{ij}$ where $i,j\in\{1,2,3\}$ (their precise definition is given in section \ref{sec:DKE}). These nine coefficients encapsulate neoclassical transport across and within flux surfaces. The parallel flow of each species can be calculated in terms of the coefficients $\widehat{D}_{3j}$ \cite{Taguchi,Sugama-PENTA,Sugama2008,MaasbergMomentumCorrection}. In the absence of externally applied loop voltage, the bootstrap current is driven by the radial electric field and gradients of density and temperature. The so-called bootstrap current coefficient $\widehat{D}_{31}$ is the one that relates the parallel flow to these gradients. The six remaining coefficients $\widehat{D}_{ij}$ for $i\in\{1,2\}$ allow to compute the flux of particles and heat across the flux surface. 

{\MONKES} also computes fast the radial transport coefficients. Although at low collisionality it is not as fast as the orbit-averaged code \texttt{KNOSOS}, {\MONKES} can compute the transition from the $1/\nu$ and $\sqrt{\nu}$-$\nu$ regimes to the plateau regime or the banana regime. The plateau regime may be relevant close to the edge, while the banana regime may be necessary for stellarators very close to perfect omnigeneity. Apart from optimization, {\MONKES} can find many other applications. For instance, it can be used for the analysis of experimental discharges or also be included in predictive transport frameworks.


This paper is organized as follows: in section \ref{sec:DKE}, we introduce the drift-kinetic equation solved by {\MONKES} and the transport coefficients that it computes. In section \ref{sec:Algorithm}, we explain the algorithm used to solve the drift-kinetic equation and its implementation. In section \ref{sec:Results_Benchmark}, by means of a convergence study, we demonstrate that {\MONKES} can be used to compute accurate monoenergetic coefficients at low collisionality very fast for the $1/\nu$ and $\sqrt{\nu}$-$\nu$ regimes \cite{dherbemont2022}. In order to show this, {\MONKES} results are also benchmarked against {\DKES} \cite{DKES1986,VanRij_1989} and, when necessary, against {\texttt{SFINCS}} \cite{Landreman_2014}. Finally, in section \ref{sec:Conclusions} we summarize the results and discuss future lines of work.

































